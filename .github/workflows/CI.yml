name: CI
on: push

jobs:
    posix:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest]
        steps:
        - uses: actions/checkout@v2
        - name: Install Dependencies
          run: vcpkg install catch2
        - name: Build Debug
          run: ./build.sh
        - name: Build Release
          run: ./buildRelease.sh
        - name: Build Docker Debug
          run: ./buildDocker.sh
        - name: Build Docker Release
          run: ./buildDockerRelease.sh
    windows:
      runs-on: windows-latest
      steps:
      - uses: actions/checkout@v2
      - name: Setup MSBuild.exe
        uses: warrenbuckley/Setup-MSBuild@v1
      - name: Install Dependencies
        run:  vcpkg install catch2
      - name: Build Debug
        run: |
          cmake --config=Debug .
          msbuild PaperTrader.sln
      - name: Build Release
        run: |
          cmake --config=Release .
          msbuild PaperTrader.sln
    codecov:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v2
        - name: Install Dependencies
          run: vcpkg install catch2
        - name: Build Project
          run: ./build.sh
        - name: Run Tests
          working-directory: build
          run: ctest -j$(nproc)
        - name: Upload Coverage
          run: |
            bash <(curl -s https://codecov.io/bash) -t ${{ secrets.CODECOV_TOKEN }}
              
